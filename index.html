<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZoomAli - Rapport d'Analyse de Consommation</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: #f4f7fa;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background-color: #fff;
            padding: 25px 40px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        h1 {
            color: #1a253c;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #5a6a85;
            margin-top: 0;
            margin-bottom: 5px;
            font-style: italic;
        }
        #breadcrumb-nav {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1em;
            color: #5a6a85;
            height: 20px;
        }
        .breadcrumb-item {
            color: #007bff;
            text-decoration: none;
            cursor: pointer;
        }
        .breadcrumb-item:hover { text-decoration: underline; }
        .breadcrumb-separator { margin: 0 8px; }
        .breadcrumb-current { font-weight: bold; color: #333; }

        #chart { cursor: pointer; }
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .controls-group { display: flex; align-items: center; gap: 15px; }
        .toggle-buttons button, .action-button, .nav-button {
            padding: 8px 15px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s, color 0.3s;
            border-radius: 5px;
        }
        .toggle-buttons button:first-child { border-top-right-radius: 0; border-bottom-right-radius: 0; }
        .toggle-buttons button:not(:first-child):not(:last-child) { border-radius: 0; border-left: none; }
        .toggle-buttons button:last-child { border-top-left-radius: 0; border-bottom-left-radius: 0; border-left: none; }
        .toggle-buttons button.active { background-color: #007bff; color: white; border-color: #007bff; }
        
        .nav-button:disabled {
            background-color: #e9ecef;
            color: #adb5bd;
            cursor: not-allowed;
            border-color: #dee2e6;
        }

        #rubrique-selector { padding: 7px; border-radius: 5px; border: 1px solid #ccc; font-size: 14px; }
        #back-button { background-color: #6c757d; color: white; border-color: #6c757d; }
        #back-button:hover { background-color: #5a6268; }
        #toggle-labels-btn { background-color: #28a745; color: white; border-color: #28a745; }
        #toggle-labels-btn:hover { background-color: #218838; }
        
        #compare-year-toggle {
            background-color: #f8f9fa;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }

        .note { margin-top: 20px; padding: 15px; background-color: #e9f5ff; border-left: 4px solid #007bff; color: #004085; font-size: 0.9em; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ZoomAli - Rapport d'Analyse de Consommation</h1>
        <p class="subtitle">Naviguez avec le fil d'Ariane, les boutons +/- ou en cliquant sur le graphique.</p>
        <div id="breadcrumb-nav"></div>
        
        <div class="toolbar">
            <div class="controls-group">
                <div id="mode-toggle" class="toggle-buttons">
                    <button id="mode-normal-btn" class="active">Normal</button>
                    <button id="mode-comparison-btn">Comparaison</button>
                    <button id="mode-cumulative-btn">Cumulé</button>
                </div>
                 <select id="rubrique-selector" style="display: none;"></select>
                 <div id="compare-year-toggle" style="display: none;">
                    <input type="checkbox" id="compare-year-checkbox">
                    <label for="compare-year-checkbox">Comparer avec N-1</label>
                 </div>
            </div>
            <div class="controls-group">
                <div class="nav-buttons" style="display: flex; gap: 5px;">
                    <button id="drill-up-btn" class="nav-button">-</button>
                    <button id="drill-down-btn" class="nav-button">+</button>
                </div>
                <div id="view-toggle" class="toggle-buttons">
                    <button id="view-bar-btn" class="active">Barres</button>
                    <button id="view-line-btn">Courbes</button>
                </div>
                <button id="toggle-labels-btn" class="action-button">Afficher les valeurs</button>
                <button id="back-button" class="action-button" style="display: none;">← Précédent</button>
            </div>
        </div>
        
        <div id="chart"></div>

        <div class="note">
            <strong>Astuce :</strong> En mode "Cumulé", cochez "Comparer avec N-1" pour voir si vous êtes en avance ou en retard sur l'année précédente.
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function() {
        // --- 1. DONNÉES ET CONFIGURATION ---
        const rawData = [
            { "rubrique": "Eau (m3)", "janv-22": 0, "févr-22": 0, "mars-22": 0, "avr-22": 0, "mai-22": 0, "juin-22": 0, "juil-22": 0, "août-22": 0, "sept-22": 0, "oct-22": 0, "nov-22": 0, "déc-22": 10, "janv-23": 0, "févr-23": 0, "mars-23": 0, "avr-23": 0, "mai-23": 0, "juin-23": 0, "juil-23": 0, "août-23": 0, "sept-23": 0, "oct-23": 0, "nov-23": 0, "déc-23": 12, "janv-24": 0, "févr-24": 0, "mars-24": 0, "avr-24": 0, "mai-24": 0, "juin-24": 0, "juil-24": 0, "août-24": 0, "sept-24": 0, "oct-24": 0, "nov-24": 0, "déc-24": 85.53 },
            { "rubrique": "Electricité (Kwh)", "janv-22": 4252, "févr-22": 4509, "mars-22": 3668, "avr-22": 3931, "mai-22": 3749, "juin-22": 4013, "juil-22": 3750, "août-22": 3890, "sept-22": 3928, "oct-22": 3670, "nov-22": 3844, "déc-22": 4047, "janv-23": 3681, "févr-23": 3899, "mars-23": 3311, "avr-23": 3548, "mai-23": 3269, "juin-23": 3432, "juil-23": 3187, "août-23": 3355, "sept-23": 3419, "oct-23": 3305, "nov-23": 3632, "déc-23": 3722, "janv-24": 3722, "févr-24": 3597.5, "mars-24": 3597.5, "avr-24": 3347.5, "mai-24": 3319.5, "juin-24": 3346, "juil-24": 3346, "août-24": 3694.5, "sept-24": 3694.5, "oct-24": 3734, "nov-24": 3734, "déc-24": 3202.5 },
            { "rubrique": "Gaz (Mwh)", "janv-22": 20.99, "févr-22": 19.95, "mars-22": 8.44, "avr-22": 5.49, "mai-22": 0, "juin-22": 0.01, "juil-22": 0, "août-22": 0, "sept-22": 0, "oct-22": 0, "nov-22": 0.47, "déc-22": 21.71, "janv-23": 20.85, "févr-23": 21.01, "mars-23": 6.87, "avr-23": 2.21, "mai-23": 0, "juin-23": 0.01, "juil-23": 0, "août-23": 0, "sept-23": 0.11, "oct-23": 0, "nov-23": 8.49, "déc-23": 14.97, "janv-24": 17.68, "févr-24": 12.29, "mars-24": 7.08, "avr-24": 1.04, "mai-24": 0.53, "juin-24": 0, "juil-24": 0, "août-24": 0, "sept-24": 0, "oct-24": 1.22, "nov-24": 8.2, "déc-24": 17.55 }
        ];
        const rubriques = rawData.map(r => r.rubrique);
        const years = [2022, 2023, 2024];
        const monthMap = { "janv": 0, "févr": 1, "mars": 2, "avr": 3, "mai": 4, "juin": 5, "juil": 6, "août": 7, "sept": 8, "oct": 9, "nov": 10, "déc": 11 };
        const monthNames = Object.keys(monthMap).map(m => m.charAt(0).toUpperCase() + m.slice(1));
        const hierarchy = ['year', 'semester', 'quadrimester', 'trimester', 'month'];
        
        const baseColors = {
            'Eau (m3)': '#008FFB',
            'Electricité (Kwh)': '#00E396',
            'Gaz (Mwh)': '#FEB019'
        };
        const defaultColors = ['#008FFB', '#00E396', '#FEB019', '#FF4560', '#775DD0', '#546E7A'];

        let flatData = [];
        rawData.forEach(row => {
            const rubrique = row.rubrique;
            for (const key in row) {
                if (key === 'rubrique') continue;
                const [monthStr, yearStr] = key.split('-');
                const year = 2000 + parseInt(yearStr, 10);
                const month = monthMap[monthStr];
                const value = typeof row[key] === 'string' ? parseFloat(row[key].replace(',', '.')) : row[key];
                flatData.push({ rubrique, date: new Date(year, month, 1), value });
            }
        });

        let chartState = {
            level: 'year', context: {}, type: 'bar', mode: 'normal',
            comparisonRubrique: rubriques[1], showDataLabels: false,
            cumulativeCompare: false
        };
        const drilldownHistory = [];
        
        const aggregateData = (level, context = {}) => { /* ... (Identique) ... */ 
            let filtered = flatData; let categories = []; let seriesData = {};
            rubriques.forEach(r => { seriesData[r] = []; });
            switch(level) {
                case 'year':
                    categories = ['2022', '2023', '2024'];
                    categories.forEach(year => {
                        rubriques.forEach(r => {
                            const sum = flatData.filter(d => d.rubrique === r && d.date.getFullYear() == year).reduce((acc, item) => acc + item.value, 0);
                            seriesData[r].push(parseFloat(sum.toFixed(2)));
                        });
                    });
                    break;
                case 'semester':
                    filtered = flatData.filter(d => d.date.getFullYear() === context.year);
                    categories = [`Semestre 1 ${context.year}`, `Semestre 2 ${context.year}`];
                    [...Array(2).keys()].forEach(i => {
                        const startMonth = i * 6; const endMonth = startMonth + 5;
                        rubriques.forEach(r => {
                            const sum = filtered.filter(d => d.rubrique === r && d.date.getMonth() >= startMonth && d.date.getMonth() <= endMonth).reduce((acc, item) => acc + item.value, 0);
                            seriesData[r].push(parseFloat(sum.toFixed(2)));
                        });
                    });
                    break;
                case 'quadrimester':
                    filtered = flatData.filter(d => d.date.getFullYear() === context.year);
                    categories = [`Quad. 1 ${context.year}`, `Quad. 2 ${context.year}`, `Quad. 3 ${context.year}`];
                     [...Array(3).keys()].forEach(i => {
                        const startMonth = i * 4; const endMonth = startMonth + 3;
                        rubriques.forEach(r => {
                            const sum = filtered.filter(d => d.rubrique === r && d.date.getMonth() >= startMonth && d.date.getMonth() <= endMonth).reduce((acc, item) => acc + item.value, 0);
                            seriesData[r].push(parseFloat(sum.toFixed(2)));
                        });
                    });
                    break;
                case 'trimester':
                    filtered = flatData.filter(d => d.date.getFullYear() === context.year);
                    categories = [`Trim. 1 ${context.year}`, `Trim. 2 ${context.year}`, `Trim. 3 ${context.year}`, `Trim. 4 ${context.year}`];
                     [...Array(4).keys()].forEach(i => {
                        const startMonth = i * 3; const endMonth = startMonth + 2;
                        rubriques.forEach(r => {
                            const sum = filtered.filter(d => d.rubrique === r && d.date.getMonth() >= startMonth && d.date.getMonth() <= endMonth).reduce((acc, item) => acc + item.value, 0);
                            seriesData[r].push(parseFloat(sum.toFixed(2)));
                        });
                    });
                    break;
                case 'month':
                    filtered = flatData.filter(d => d.date.getFullYear() === context.year);
                    categories = monthNames.map(m => `${m} ${context.year}`);
                    categories.forEach((cat, i) => {
                         rubriques.forEach(r => {
                            const monthData = filtered.find(d => d.rubrique === r && d.date.getMonth() === i);
                            seriesData[r].push(monthData ? parseFloat(monthData.value.toFixed(2)) : 0);
                        });
                    });
                    break;
            }
            const series = Object.keys(seriesData).map(rubrique => ({ name: rubrique, data: seriesData[rubrique] }));
            return { series, categories };
        };
        const getComparisonData = (level, rubrique) => { /* ... (Identique) ... */ 
            const dataForRubrique = flatData.filter(d => d.rubrique === rubrique);
            let categories = [];
            let periods = [];

            switch (level) {
                case 'semester':
                    categories = ['Semestre 1', 'Semestre 2'];
                    periods = [ { s: 0, e: 5 }, { s: 6, e: 11 } ];
                    break;
                case 'quadrimester':
                    categories = ['Quad. 1', 'Quad. 2', 'Quad. 3'];
                    periods = [ { s: 0, e: 3 }, { s: 4, e: 7 }, { s: 8, e: 11 } ];
                    break;
                case 'trimester':
                    categories = ['Trim. 1', 'Trim. 2', 'Trim. 3', 'Trim. 4'];
                    periods = [ { s: 0, e: 2 }, { s: 3, e: 5 }, { s: 6, e: 8 }, { s: 9, e: 11 } ];
                    break;
                default: // 'year' or 'month' level comparison defaults to month-by-month
                    categories = monthNames;
                    periods = monthNames.map((_, i) => ({ s: i, e: i }));
                    break;
            }

            const series = years.map(year => {
                const yearData = periods.map(p => {
                    const sum = dataForRubrique
                        .filter(d => d.date.getFullYear() === year && d.date.getMonth() >= p.s && d.date.getMonth() <= p.e)
                        .reduce((acc, item) => acc + item.value, 0);
                    return parseFloat(sum.toFixed(2));
                });
                return { name: String(year), data: yearData };
            });

            return { series, categories };
        };
        const calculateCumulative = (series) => { /* ... (Identique) ... */ 
            return series.map(s => {
                let sum = 0;
                const cumulativeData = s.data.map(val => { sum += val; return parseFloat(sum.toFixed(2)); });
                return { ...s, data: cumulativeData };
            });
        };

        const renderBreadcrumbs = () => { /* ... (Identique) ... */ 
            const nav = document.getElementById('breadcrumb-nav');
            nav.innerHTML = '';
            if (chartState.level === 'year' || chartState.mode !== 'normal') return;

            const createLink = (text, level, context) => {
                const link = document.createElement('a');
                link.textContent = text;
                link.className = 'breadcrumb-item';
                link.onclick = () => {
                    drilldownHistory.push({ ...chartState });
                    chartState.level = level;
                    chartState.context = context;
                    renderChart();
                };
                return link;
            };
            
            const createSeparator = () => {
                const sep = document.createElement('span');
                sep.className = 'breadcrumb-separator';
                sep.textContent = '>';
                return sep;
            };

            nav.appendChild(createLink('Vue Globale', 'year', {}));

            if (chartState.context.year) {
                nav.appendChild(createSeparator());
                const yearLink = createLink(chartState.context.year, 'semester', { year: chartState.context.year });
                nav.appendChild(yearLink);
            }
            
            const levelNames = { semester: 'Semestres', quadrimester: 'Quadrimestres', trimester: 'Trimestres', month: 'Mois' };
            if (chartState.level !== 'year' && chartState.level !== 'semester') {
                 nav.appendChild(createSeparator());
                 const current = document.createElement('span');
                 current.className = 'breadcrumb-current';
                 current.textContent = levelNames[chartState.level];
                 nav.appendChild(current);
            }
        };

        const renderChart = () => {
            const { level, context, type, mode, comparisonRubrique, showDataLabels, cumulativeCompare } = chartState;
            let data, title, dynamicColors, dynamicDashArray;
            
            let allowDrilldown = level !== 'month';

            switch (mode) {
                case 'comparison':
                    data = getComparisonData(level, comparisonRubrique);
                    const levelName = { year: 'Mensuelle', semester: 'Semestrielle', quadrimester: 'Quadrimestrielle', trimester: 'Trimestrielle', month: 'Mensuelle' }[level];
                    title = `Comparaison ${levelName} - ${comparisonRubrique}`;
                    dynamicColors = defaultColors;
                    dynamicDashArray = [0];
                    break;
                case 'cumulative':
                    const currentYearData = aggregateData(level, context);
                    if (cumulativeCompare && context.year && context.year > years[0]) {
                        const prevContext = { ...context, year: context.year - 1 };
                        const prevYearData = aggregateData(level, prevContext);
                        
                        const currentSeries = currentYearData.series.map(s => ({ ...s, name: `${s.name} - ${context.year}` }));
                        const prevSeries = prevYearData.series.map(s => ({ ...s, name: `${s.name} - ${prevContext.year}` }));

                        const cumulativeCurrent = calculateCumulative(currentSeries);
                        const cumulativePrev = calculateCumulative(prevSeries);
                        
                        data = {
                            series: [...cumulativeCurrent, ...cumulativePrev],
                            categories: currentYearData.categories.map(c => c.split(' ')[0] + ' ' + c.split(' ')[1])
                        };
                        title = `Cumulatif Comparé - ${context.year} vs ${prevContext.year}`;

                        dynamicColors = [];
                        dynamicDashArray = [];
                        data.series.forEach(s => {
                            const baseRubrique = rubriques.find(r => s.name.includes(r));
                            dynamicColors.push(baseColors[baseRubrique] || '#808080');
                            dynamicDashArray.push(s.name.includes(String(prevContext.year)) ? 5 : 0);
                        });

                    } else {
                        data = {
                            series: calculateCumulative(currentYearData.series),
                            categories: currentYearData.categories
                        };
                        // MODIFICATION : Logique de titre robuste pour éviter "undefined"
                        const yearLabel = context.year || 'Années';
                        title = `Vue Cumulée - ${level === 'year' ? 'Années' : yearLabel}`;
                    }
                    break;
                default: // 'normal'
                    data = aggregateData(level, context);
                    title = {
                        'year': 'Vue Annuelle Globale', 'semester': `Détail par Semestre - ${context.year}`,
                        'quadrimester': `Détail par Quadrimestre - ${context.year}`, 'trimester': `Détail par Trimestre - ${context.year}`,
                        'month': `Détail Mensuel - ${context.year}`
                    }[level];
                    dynamicColors = Object.values(baseColors);
                    dynamicDashArray = [0];
                    break;
            }

            chart.updateOptions({
                chart: { type: type, events: { dataPointSelection: allowDrilldown ? handleDataPointSelection : undefined } },
                series: data.series,
                xaxis: { categories: data.categories },
                title: { text: title },
                colors: dynamicColors,
                plotOptions: { bar: { columnWidth: '70%', grouped: true } },
                stroke: {
                    curve: 'smooth', width: type === 'line' ? 3 : 2,
                    colors: type === 'bar' ? ['transparent'] : undefined,
                    dashArray: dynamicDashArray
                },
                markers: { size: type === 'line' ? 5 : 0 },
                dataLabels: {
                    enabled: showDataLabels,
                    formatter: (val) => (typeof val !== 'number') ? val : val.toLocaleString('fr-FR', { maximumFractionDigits: val > 100 ? 0 : 2 }),
                    style: { fontSize: '12px', colors: type === 'bar' ? ["#fff"] : ["#333"] },
                    offsetY: type === 'line' ? -10 : 0,
                },
            });
            updateUI();
            renderBreadcrumbs();
        };

        const updateUI = () => {
            const { mode, type, showDataLabels, level, context } = chartState;
            document.querySelectorAll('#mode-toggle button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`mode-${mode}-btn`).classList.add('active');
            
            document.querySelectorAll('#view-toggle button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`view-${type}-btn`).classList.add('active');

            document.getElementById('rubrique-selector').style.display = mode === 'comparison' ? 'block' : 'none';
            
            const compareToggle = document.getElementById('compare-year-toggle');
            compareToggle.style.display = (mode === 'cumulative' && level !== 'year') ? 'block' : 'none';
            
            document.getElementById('back-button').style.display = drilldownHistory.length > 0 ? 'inline-block' : 'none';
            document.getElementById('toggle-labels-btn').textContent = showDataLabels ? 'Cacher les valeurs' : 'Afficher les valeurs';

            const drillUpBtn = document.getElementById('drill-up-btn');
            const drillDownBtn = document.getElementById('drill-down-btn');
            const currentIndex = hierarchy.indexOf(level);

            drillUpBtn.disabled = (currentIndex <= 0);
            
            const atBottom = currentIndex >= hierarchy.length - 1;
            // MODIFICATION : La condition pour bloquer le bouton "+" est maintenant plus intelligente
            const needsContext = (mode === 'normal' || mode === 'cumulative');
            const stuckAtTop = (level === 'year' && !context.year && needsContext);
            
            drillDownBtn.disabled = atBottom || stuckAtTop;
        };

        const handleDataPointSelection = (e, chartContext, config) => {
            const { dataPointIndex } = config;
            const currentLevelIndex = hierarchy.indexOf(chartState.level);
            if (currentLevelIndex >= hierarchy.length - 1) return;

            const nextLevel = hierarchy[currentLevelIndex + 1];
            let newContext = { ...chartState.context };
            
            // MODIFICATION : On définit le contexte de l'année même en mode Cumulé
            if(chartState.level === 'year' && (chartState.mode === 'normal' || chartState.mode === 'cumulative')) {
                newContext.year = parseInt(chart.w.globals.labels[dataPointIndex]);
            }
            
            drilldownHistory.push({ ...chartState });
            chartState.level = nextLevel;
            chartState.context = newContext;
            renderChart();
        };

        const handleDrillUp = () => {
            const currentIndex = hierarchy.indexOf(chartState.level);
            if (currentIndex <= 0) return;
            
            const parentLevel = hierarchy[currentIndex - 1];
            let newContext = { ...chartState.context };
            if (parentLevel === 'year') {
                newContext = {};
            }

            drilldownHistory.push({ ...chartState });
            chartState.level = parentLevel;
            chartState.context = newContext;
            renderChart();
        };

        const handleDrillDown = () => {
            const currentIndex = hierarchy.indexOf(chartState.level);
            if (currentIndex >= hierarchy.length - 1) return;
            
            const nextLevel = hierarchy[currentIndex + 1];
            drilldownHistory.push({ ...chartState });
            chartState.level = nextLevel;
            renderChart();
        };

        document.getElementById('drill-up-btn').addEventListener('click', handleDrillUp);
        document.getElementById('drill-down-btn').addEventListener('click', handleDrillDown);

        document.getElementById('back-button').addEventListener('click', () => {
            if (drilldownHistory.length > 0) { chartState = drilldownHistory.pop(); renderChart(); }
        });

        ['normal', 'comparison', 'cumulative'].forEach(mode => {
            document.getElementById(`mode-${mode}-btn`).addEventListener('click', () => {
                if (chartState.mode !== mode) {
                    chartState.mode = mode;
                    renderChart();
                }
            });
        });

        ['bar', 'line'].forEach(type => {
            document.getElementById(`view-${type}-btn`).addEventListener('click', () => {
                if (chartState.type !== type) { chartState.type = type; renderChart(); }
            });
        });
        
        const rubriqueSelector = document.getElementById('rubrique-selector');
        rubriques.forEach(r => {
            const option = document.createElement('option');
            option.value = r; option.textContent = r; rubriqueSelector.appendChild(option);
        });
        rubriqueSelector.value = chartState.comparisonRubrique;
        rubriqueSelector.addEventListener('change', (e) => {
            chartState.comparisonRubrique = e.target.value; renderChart();
        });

        document.getElementById('toggle-labels-btn').addEventListener('click', () => {
            chartState.showDataLabels = !chartState.showDataLabels;
            renderChart();
        });

        document.getElementById('compare-year-checkbox').addEventListener('change', (e) => {
            chartState.cumulativeCompare = e.target.checked;
            renderChart();
        });

        const getUnit = (rubrique) => rubrique.match(/\(([^)]+)\)/)[1] || '';
        const chart = new ApexCharts(document.querySelector("#chart"), {
            chart: { type: 'bar', height: 500, toolbar: { show: true, tools: { download: true, selection: false, zoom: false, zoomin: false, zoomout: false, pan: false, reset: false } } },
            series: [],
            plotOptions: { bar: { columnWidth: '70%', grouped: true } },
            dataLabels: { enabled: false },
            stroke: { show: true, width: 2, colors: ['transparent'] },
            yaxis: { title: { text: 'Consommation' } },
            fill: { opacity: 1 },
            tooltip: { y: { formatter: (val, { series, seriesIndex }) => `${val.toLocaleString('fr-FR', {maximumFractionDigits: 2})} ${getUnit(series[seriesIndex].name)}` } },
            title: { text: ' ', align: 'center', style: { fontSize: '20px', color: '#263238' } },
            noData: { text: 'Chargement...' },
            colors: defaultColors,
        });
        chart.render();
        renderChart();
    });
    </script>

</body>
</html>